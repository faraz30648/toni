<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>TONI — INTEL</title>
    <link rel="stylesheet" href="css/style.css">
</head>
<body>

    <div class="video-background">
        <video autoplay muted loop playsinline id="bg-video">
            <source src="https://storage.googleapis.com/gtv-videos-bucket/sample/ForBiggerMeltdowns.mp4" type="video/mp4">
        </video>
        <div class="video-overlay"></div>
    </div>

    <nav class="navbar">
        <a href="index.html" class="brand-logo">TONI</a>
        
        <button class="mobile-menu-btn" aria-label="Toggle Menu" onclick="toggleMenu()">
            <span id="menu-icon">☰</span>
        </button>

        <ul class="nav-links">
            <li><a href="index.html" class="mono">Portal</a></li>
            <li><a href="drops.html" class="mono">Drops</a></li>
            <li><a href="blog.html" class="active mono">Intel</a></li>
            <li><a href="access.html" class="mono">Access</a></li>
        </ul>
    </nav>

    <main class="container section tilt-element" style="padding-top: 120px;">
        <header style="margin-bottom: 3rem; border-bottom: 1px solid rgba(255,255,255,0.1); padding-bottom: 1rem;">
            <h1 class="mono dim">MARKET INTEL</h1>
            <p class="mono text-sub" style="margin-top: 1rem; max-width: 500px;">
                Live feed from the underground.<br>
                <span style="color: #ffd700;">// STATUS: CONNECTED TO GLOBAL NETWORK</span>
            </p>
        </header>

        <div id="blog-grid" class="blog-list">
            <div class="loading-state mono">ESTABLISHING CONNECTION...</div>
        </div>
    </main>

    <script>
        function toggleMenu() {
            const nav = document.querySelector('.nav-links');
            const btn = document.getElementById('menu-icon');
            nav.classList.toggle('active');
            if (nav.classList.contains('active')) {
                btn.innerHTML = '✕';
                document.body.style.overflow = 'hidden'; 
            } else {
                btn.innerHTML = '☰';
                document.body.style.overflow = 'auto';
            }
        }

        // --- REAL API FETCHING ---
        
        // We use rss2json to convert real RSS feeds into usable JSON data
        const FEED_GLOBAL = 'https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fsneakernews.com%2Ffeed%2F';
        const FEED_INDIA = 'https://api.rss2json.com/v1/api.json?rss_url=https%3A%2F%2Fnews.google.com%2Frss%2Fsearch%3Fq%3Dcollectibles%2Bmarket%2Bindia%26hl%3Den-IN%26gl%3DIN%26ceid%3DIN%3Aen';

        async function fetchMarketIntel() {
            const container = document.getElementById('blog-grid');
            
            try {
                // 1. Fetch both feeds in parallel
                const [globalRes, indiaRes] = await Promise.all([
                    fetch(FEED_GLOBAL),
                    fetch(FEED_INDIA)
                ]);

                const globalData = await globalRes.json();
                const indiaData = await indiaRes.json();

                // 2. Process & Tag Data
                let articles = [];

                // Process Global Items
                if (globalData.items) {
                    articles = articles.concat(globalData.items.map(item => ({
                        title: item.title,
                        date: item.pubDate.split(' ')[0],
                        snippet: stripHtml(item.description).substring(0, 120) + '...',
                        content: item.description, // Store full desc for article page
                        link: item.link,
                        image: item.thumbnail || item.enclosure?.link || '',
                        tag: 'GLOBAL',
                        source: 'SNEAKERNEWS'
                    })));
                }

                // Process India Items
                if (indiaData.items) {
                    articles = articles.concat(indiaData.items.map(item => ({
                        title: item.title,
                        date: item.pubDate.split(' ')[0],
                        snippet: stripHtml(item.description).substring(0, 120) + '...',
                        content: item.description,
                        link: item.link,
                        image: '', // Google RSS rarely has clean images
                        tag: 'INDIA',
                        source: 'MARKET_WIRE'
                    })));
                }

                // 3. Sort by date (Newest first)
                articles.sort((a, b) => new Date(b.date) - new Date(a.date));

                // 4. Render
                container.innerHTML = '';
                
                articles.forEach((post, index) => {
                    const article = document.createElement('article');
                    article.className = 'blog-card';
                    
                    // We save the article data to localStorage so article.html can read it
                    // without needing a backend database.
                    const safeId = `post_${index}`;
                    
                    article.innerHTML = `
                        <div class="blog-meta mono">
                            <span class="blog-date">${post.date}</span>
                            <span class="blog-cat" style="color: ${post.tag === 'INDIA' ? '#ff9933' : '#ffd700'}">[${post.tag}]</span>
                        </div>
                        <h2 class="blog-title">${post.title}</h2>
                        <p class="blog-snippet mono">${post.snippet}</p>
                        <div class="blog-tags">
                            <span class="tag">#${post.source}</span>
                        </div>
                        <button onclick="readArticle('${safeId}')" class="read-btn mono">ACCESS_DATA ></button>
                    `;
                    
                    // Save to memory
                    sessionStorage.setItem(safeId, JSON.stringify(post));
                    
                    container.appendChild(article);
                });

            } catch (error) {
                console.error(error);
                container.innerHTML = `<div class="error-state mono">SIGNAL LOST: UNABLE TO FETCH EXTERNAL DATA</div>`;
            }
        }

        function readArticle(id) {
            // Navigate to article page with the ID
            window.location.href = `article.html?id=${id}`;
        }

        // Helper to clean up RSS descriptions
        function stripHtml(html) {
            let tmp = document.createElement("DIV");
            tmp.innerHTML = html;
            return tmp.textContent || tmp.innerText || "";
        }

        document.addEventListener('DOMContentLoaded', fetchMarketIntel);
    </script>
</body>
</html>
